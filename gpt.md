# IaC活用 要件定義書（ドラフト）

## 1. 目的

本要件定義書は、AWSを用いて構築するシステムにおいて、Infrastructure as Code（以下、IaC）を活用したインフラ管理を実現するための要件を定義することを目的とする。IaCの導入により、インフラ構成の再現性・一貫性・変更容易性・品質向上を図り、運用負荷および人的ミスの低減を目指す。

## 2. 適用範囲

* AWS上に構築されるすべてのインフラリソース
* ネットワーク、コンピュート、ストレージ、セキュリティ、監視などの基盤レイヤ
* 開発・検証・本番環境を含む複数環境

## 3. 前提条件

* クラウド基盤はAWSを利用する
* IaCツールはTerraformを主とする（将来的な拡張は妨げない）
* ソースコード管理にはGitを利用する
* CI/CD基盤の利用を前提とする

## 4. IaC活用の基本方針

### 4.1 全構成のコード化

* AWS上のインフラ構成は原則すべてIaCで定義する
* 手動操作による構成変更は例外扱いとし、恒久対応は必ずコードへ反映する

### 4.2 再現性の確保

* 同一コードから同一構成の環境を再現可能であること
* 環境差異は変数や設定ファイルで明示的に管理する

### 4.3 変更管理の明確化

* すべての変更はGit上の履歴として追跡可能とする
* レビュー・承認プロセスを経た変更のみを反映する

## 5. 機能要件

### 5.1 リソース定義

* VPC、サブネット、ルーティング、セキュリティグループ
* EC2、ECS、EKSなどのコンピュートリソース
* RDS、S3、EFS等のストレージ
* IAMロール・ポリシー
* 監視・ログ関連リソース（CloudWatch等）

### 5.2 環境分離

* 開発・検証・本番環境を論理的に分離する
* アカウント分離またはWorkspace/Backend分離を採用する

### 5.3 モジュール化

* 再利用可能な単位でTerraformモジュールを作成する
* モジュールは責務が明確で疎結合であること

## 6. 非機能要件

### 6.1 可読性・保守性

* 命名規則・ディレクトリ構成を標準化する
* README等によるドキュメントを整備する

### 6.2 安全性

* plan/applyの分離を行い、直接applyを禁止する運用を基本とする
* 本番環境への適用には明示的な承認ステップを設ける

### 6.3 セキュリティ

* 機密情報はコードに直接記載しない
* AWS Secrets ManagerやSSM Parameter Storeを利用する

### 6.4 品質担保

* terraform validate / fmt / lint（tflint等）をCIで実行する
* セキュリティスキャン（例：Trivy, tfsec）の導入を検討する

## 7. 運用要件

### 7.1 CI/CD連携

* GitHub Actions等を用いた自動検証パイプラインを構築する
* Pull Request作成時にplanを自動実行し差分を可視化する

### 7.2 状態管理

* Terraform stateはリモートBackend（S3 + DynamoDB Lock）で管理する
* stateへの直接操作は禁止する

### 7.3 障害・復旧対応

* IaCにより迅速に環境再構築できること
* state破損時の復旧手順を定義する

## 8. 制約事項

* AWSのサービス制限・クォータに依存する
* 既存手動構築リソースのIaC移行には段階的対応が必要

## 9. 今後の検討事項

* GitOps的運用（自動apply）の是非
* マルチリージョン・マルチアカウント戦略
* 他IaCツール（CDK等）との使い分け

---

本ドラフトは要件定義初期段階のたたきであり、プロジェクト特性や組織方針に応じて詳細化・修正を行うことを前提とする。
